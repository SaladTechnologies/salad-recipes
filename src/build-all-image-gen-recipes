#! /usr/bin/bash
set -e

usage="Usage: ./build --comfy <comfy-version> --api <api-version> [--push]"

push=""
while [ "$1" != "" ]; do
  case $1 in
  --comfy)
    shift
    comfy_version=$1
    ;;
  --api)
    shift
    api_version=$1
    ;;

  --push)
    push="--push"
    ;;
  *)
    echo $usage
    exit 1
    ;;
  esac
  shift
done

if [ -z "$comfy_version" ] || [ -z "$api_version" ]; then
  echo $usage
  exit 1
fi

# Build the base image
pushd comfyui-base
echo "Building comfyui-base"
./build --comfy $comfy_version --api $api_version $push
popd

# Build the dreamshaper8 image
pushd dreamshaper8-comfyui
echo "Building dreamshaper8"
./build --comfy $comfy_version --api $api_version $push
popd

# Build the flux1-schnell-fp8 image
pushd flux1-schnell-fp8-comfyui
echo "Building flux1-schnell-fp8"
./build --comfy $comfy_version --api $api_version $push
popd

pushd sd3.5-large-comfyui
echo "Building sd3.5-large"
./build --comfy $comfy_version --api $api_version $push
popd

pushd sd3.5-medium-comfyui
echo "Building sd3.5-medium"
./build --comfy $comfy_version --api $api_version $push
popd

# Build the sdxl-with-refiner image
pushd sdxl-with-refiner-comfyui
echo "Building sdxl-with-refiner"
./build --comfy $comfy_version --api $api_version $push
popd